# EVAL TEST CASE TEMPLATE
# Copy this file and fill in with actual test data
# File naming: {category}_{number}.yaml (e.g., valid_warranty_001.yaml)

# Unique identifier for this test case
scenario_id: example_001

# Human-readable description of what this scenario tests
description: "Brief description of the scenario being tested"

# Category for grouping related scenarios
# Examples: valid-warranty, invalid-warranty, missing-info, out-of-scope
category: example-category

# Date this test case was created (format: "YYYY-MM-DD")
created: "2026-01-18"

# INPUT SECTION
# Defines the email input and mock function responses
input:
  # Email content to process
  email:
    subject: "Email subject line"
    body: "Email body text with relevant details like serial number SN12345"
    from: "customer@example.com"
    received: "2026-01-18T10:00:00Z"  # ISO 8601 format

  # Mock responses for function calls
  # Define what each function should return when called
  mock_function_responses:
    check_warranty:
      serial_number: "SN12345"
      status: "valid"  # or "expired", "invalid", "not_found"
      expiration_date: "2025-12-31"
      coverage: "full"
    create_ticket:
      ticket_id: "TKT-12345"
      status: "created"
    send_email:
      message_id: "msg-abc123"
      status: "sent"

# EXPECTED OUTPUT SECTION
# Defines what functions should be called and in what order
expected_output:
  # Which scenario instruction file should be used (required)
  scenario_instruction_used: "valid-warranty"

  # Maximum processing time in milliseconds (optional, default: 60000)
  processing_time_ms: 60000

  # FUNCTION CALL EXPECTATIONS (primary validation method)
  # List of expected function calls in order
  expected_function_calls:
    # First function call
    - function_name: check_warranty
      # Exact argument match (all keys must match exactly)
      arguments:
        serial_number: "SN12345"
      # Validate specific fields in the result
      result_contains:
        status: "valid"

    # Second function call
    - function_name: create_ticket
      # Partial argument match (only specified keys must be present)
      arguments_contain:
        serial_number: "SN12345"
        customer_email: "customer@example.com"

    # Final function call - send_email is REQUIRED for all scenarios
    - function_name: send_email
      arguments_contain:
        to: "customer@example.com"
      # For send_email: validate email body content
      body_contains:
        - "SN12345"           # Serial number mentioned
        - "2025-12-31"        # Expiration date included
        - "TKT-12345"         # Ticket ID referenced


# FUNCTION CALL VALIDATION OPTIONS

# arguments: Exact match - ALL specified keys must match exactly
#   arguments:
#     serial_number: "SN12345"
#     status: "pending"

# arguments_contain: Partial match - specified keys must be present with matching values
#   arguments_contain:
#     serial_number: "SN12345"
#     # other arguments are ignored

# result_contains: Validate function returned expected data
#   result_contains:
#     status: "valid"
#     # only checks specified fields

# body_contains: For send_email only - validate email body text
#   body_contains:
#     - "warranty"
#     - "ticket"


# EXAMPLE SCENARIOS BY TYPE

# Valid Warranty (3 function calls):
#   1. check_warranty(serial_number) -> status: valid
#   2. create_ticket(serial, email, priority) -> ticket_id
#   3. send_email(to, subject, body with warranty info + ticket id)

# Invalid/Expired Warranty (2 function calls):
#   1. check_warranty(serial_number) -> status: expired
#   2. send_email(to, subject, body explaining warranty expired)
#   NOTE: No create_ticket - only valid warranties get tickets

# Missing Info (1 function call):
#   1. send_email(to, subject, body asking for serial number)
#   NOTE: No check_warranty - no serial to check

# Graceful Degradation (1 function call):
#   1. send_email(to, subject, polite decline/redirect)
#   NOTE: For out-of-scope or unrecognized requests


# INSTRUCTIONS FOR USE
# 1. Copy this template to a new file: {category}_{number}.yaml
# 2. Fill in scenario_id, description, category, created
# 3. Define the input email content
# 4. Define mock_function_responses for all functions that will be called
# 5. Define expected_function_calls in the order they should occur
# 6. Place file in evals/scenarios/ directory
# 7. Run eval to verify: uv run python -m guarantee_email_agent eval
# 8. Iterate on instructions until test passes


# TIPS FOR CREATING GOOD TEST CASES

# 1. Test One Thing
#    - Each test case should focus on one specific scenario
#    - Don't combine multiple edge cases in one test

# 2. Validate Function Call Order
#    - List expected_function_calls in the exact order they should occur
#    - check_warranty should come before create_ticket
#    - send_email should always be LAST

# 3. Use body_contains for Email Validation
#    - Check that key information appears in the email
#    - Serial number, dates, ticket IDs, etc.

# 4. Mock Realistic Responses
#    - Use realistic data in mock_function_responses
#    - Match the actual API response format

# 5. Keep Tests Independent
#    - Each test should work in isolation
#    - Don't depend on state from other tests
