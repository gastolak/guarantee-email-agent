# Agent Configuration File
# This file contains non-secret configuration for the warranty email agent
# Secrets (API keys) are loaded from environment variables (see .env.example)

# LLM Provider Configuration
# Choose between Anthropic Claude or Google Gemini
llm:
  provider: "gemini"  # "anthropic" or "gemini"
  model: "gemini-3-flash-preview"  # Model name: "claude-3-5-sonnet-20241022" or "gemini-2.5-flash-preview-05-20"
  temperature: 0  # Determinism for eval reproducibility
  max_tokens: 8192  # Gemini 2.0 Flash maximum output tokens (hard limit)
  timeout_seconds: 60

# Evaluation Suite Configuration
# Test suite path and pass rate threshold
eval:
  pass_threshold: 99.0  # Target: ≥99% pass rate (NFR1)
  test_suite_path: "./evals/scenarios/"

# Instruction File Paths
# Main orchestration instruction and scenario-specific instructions
instructions:
  main: "./instructions/main.md"
  scenarios:
    # Legacy scenarios (kept for backwards compatibility)
    - "./instructions/scenarios/serial-number-found.md"
    - "./instructions/scenarios/valid-warranty.md"
    - "./instructions/scenarios/invalid-warranty.md"
    - "./instructions/scenarios/missing-info.md"
    - "./instructions/scenarios/graceful-degradation.md"
    # New step-based workflow scenarios
    - "./instructions/scenarios/step-01-extract-serial.md"
    - "./instructions/scenarios/step-02-check-warranty.md"
    - "./instructions/scenarios/step-03a-valid-warranty.md"
    - "./instructions/scenarios/step-03b-device-not-found.md"
    - "./instructions/scenarios/step-03c-expired-warranty.md"
    - "./instructions/scenarios/step-03d-request-serial.md"
    - "./instructions/scenarios/step-04-out-of-scope.md"
    - "./instructions/scenarios/step-05-send-confirmation.md"

# Agent Runtime Configuration
# Story 5.1: Step-by-step state machine architecture
agent:
  polling_interval_seconds: 60
  shutdown_timeout_seconds: 30
  max_consecutive_errors: 10
  use_step_orchestrator: true  # Use step-by-step state machine (vs monolithic scenarios)
  admin_email: "admin@suntar.pl"  # Admin email for VIP warranty alerts (Task 8)
  supervisor_email: "supervisor@suntar.pl"  # Supervisor email for escalations (Task 10)

# Logging Configuration
# NFR14: Customer email body logged ONLY at DEBUG level
# NFR16: Logs to stdout only (stateless, no file handlers)
logging:
  level: "INFO"  # Options: DEBUG, INFO, WARNING, ERROR
  json_format: false  # true for production (machine-readable), false for development (human-readable)
  log_to_stdout: true  # Always true per NFR16 (stateless)

# Tool Configuration
# Direct API integration (no MCP layer)
# Credentials loaded from environment variables
tools:
  gmail:
    api_endpoint: "https://gmail.googleapis.com/gmail/v1"
    timeout_seconds: 10
    # Uses GMAIL_OAUTH_TOKEN from environment

  crm_abacus:
    base_url: "http://crmabacus.suntar.pl:43451"
    token_endpoint: "/token"
    warranty_endpoint: "/klienci/znajdz_po_numerze_seryjnym/"
    ticketing_endpoint: "/zadania/dodaj_zadanie/"
    ticket_info_endpoint: "/zadania/{zadanie_id}/info/"
    task_info_endpoint: "/zadania/{zadanie_id}"
    task_feature_check_endpoint: "/zadania/{zadanie_id}/cechy/check"
    timeout_seconds: 10
    # Uses CRM_ABACUS_USERNAME and CRM_ABACUS_PASSWORD from environment

    # Default IDs for ticket creation (per CRM Abacus API spec)
    ticket_defaults:
      dzial_id: 2                    # Customer Service Department
      typ_zadania_id: 156            # Service Request type
      typ_wykonania_id: 184          # Awaiting Review status
      organizacja_id: 1              # Suntar organization
      unrecognized_klient_id: 702    # Default client when device not found

    # Feature flag name for disabling AI agent responses
    agent_disable_feature_name: "Wyłącz agenta AI"
